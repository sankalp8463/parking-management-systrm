<div class="page-title-section">
  <h1>In-premise Vehicles</h1>
</div>

<div class="parking-page">
  <div class="container">

    <!-- Active Entries Table -->
    <div class="active-entries">
      <div class="slots-header">
        <div class="slots-header-actions">
          <button class="btn-action" (click)="openCheckoutModal()">Check Out Vehicle</button>
        </div>
      </div>

      <div class="entries-table">
        <table>
          <thead>
            <tr>
              <th>Vehicle Number</th>
              <th>Slot</th>
              <th>Entry Time</th>
              <th>Duration</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let entry of activeEntries" [attr.data-vehicle]="entry.vehicleNumber">
              <td>
                <strong>{{entry.vehicleNumber}}</strong>
                <small class="vehicle-type">{{entry.vehicleType || 'N/A'}}</small>
              </td>
              <td><span class="slot-badge">{{entry.slotNumber}}</span></td>
              <td>{{entry.entryTime | date:'MMM d, y, h:mm a'}}</td>
              <td><span class="duration-badge">{{entry.duration}}</span></td>
              <td>
                <button class="btn-exit" (click)="exitVehicleByNumber(entry.vehicleNumber)">Exit</button>
              </td>
            </tr>
            <tr *ngIf="!activeEntries || activeEntries.length === 0">
              <td colspan="5" class="no-data">
                <div class="empty-state"><p>No vehicles currently parked</p></div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal" *ngIf="showCheckoutModal" (click)="closeCheckoutModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h3>Check Out Vehicle</h3>

        <!-- Tabs -->
        <div class="checkout-tabs">
          <button type="button" [class.active]="!useScanner" (click)="useScanner=false">Manual Entry</button>
          <button type="button" [class.active]="useScanner" (click)="useScanner=true">Scan QR</button>
        </div>

        <!-- Manual Entry -->
        <form *ngIf="!useScanner" (ngSubmit)="exitVehicleByVehicleNumber()" #exitForm="ngForm">
          <div class="form-group">
            <label for="vehicleNumber"><strong>Vehicle Number</strong></label>
            <input type="text" id="vehicleNumber" [(ngModel)]="exitData.vehicleNumber" name="vehicleNumber" required placeholder="Enter vehicle number" />
          </div>

          <!-- Quick Select -->
          <div class="form-group" *ngIf="activeEntries && activeEntries.length > 0">
            <label><strong>Quick Select</strong></label>
            <select (change)="onQuickSelectVehicle($event)">
              <option value="">Choose from parked vehicles...</option>
              <option *ngFor="let entry of activeEntries" [value]="entry.vehicleNumber">
                {{entry.vehicleNumber}} - Slot {{entry.slotNumber}} ({{entry.duration}})
              </option>
            </select>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" (click)="closeCheckoutModal()">Cancel</button>
            <button type="submit" class="btn-primary">Check Out</button>
          </div>
        </form>

        <!-- QR Scanner -->
        <div *ngIf="useScanner">
          <app-qr-scanner (vehicleFound)="onVehicleScanned($event)"></app-qr-scanner>
          
          <p *ngIf="exitData.vehicleNumber" class="scanned-result">
            Scanned Vehicle: <b>{{ exitData.vehicleNumber }}</b>
          </p>

          <div class="modal-actions">
            <button class="btn-secondary" type="button" (click)="closeCheckoutModal()">Cancel</button>
          </div>
        </div>

      </div>
    </div>

    <!-- Payment Modal -->
    <app-payment-modal
      *ngIf="showPaymentModal"
      [paymentData]="paymentData"
      (paymentComplete)="onPaymentComplete()"
      (modalClose)="onModalClose()">
    </app-payment-modal>

  </div>
</div>
