<div class="slots-page">
  <div class="container">
    <h1>Parking Slot Management</h1>

    <!-- Enhanced Stats Section with Add Button -->
    <div class="slots-overview">
      <div class="stats-header">
        <h2>Slot Statistics</h2>
        <button class="add-slot-btn" (click)="openAddModal()">
          <span class="add-icon">+</span>
          <span>Add Slot</span>
        </button>
      </div>

      <div class="stats-grid">
        <div class="stat-card available">
          <h3>Available</h3>
          <p class="stat-number">{{ slotStats.available }}</p>
        </div>
        <div class="stat-card occupied">
          <h3>Occupied</h3>
          <p class="stat-number">{{ slotStats.occupied }}</p>
        </div>
        <div class="stat-card maintenance">
          <h3>Maintenance</h3>
          <p class="stat-number">{{ slotStats.maintenance }}</p>
        </div>
        <div class="stat-card total">
          <h3>Total Slots</h3>
          <p class="stat-number">{{ slotStats.total }}</p>
        </div>
      </div>
    </div>
    <div class="available-slots-section" *ngIf="newSlot.vehicleType">
      <label class="section-label">Available Slots for {{ newSlot.vehicleType | titlecase }}:</label>
      <div class="slots-preview">
        <div
          *ngFor="let slot of getAvailableSlotsByType(newSlot.vehicleType)"
          class="preview-slot available"
          (click)="selectSlotForBooking(slot)">
          {{ convertForDisplay(slot) }}
        </div>
        <div
          *ngFor="let emptySlot of getEmptySlotsByType(newSlot.vehicleType)"
          class="preview-slot empty"
          (click)="selectEmptySlot(emptySlot)">
          {{ emptySlot }}
        </div>
      </div>
      <p class="slots-info" *ngIf="getAvailableSlotsByType(newSlot.vehicleType).length === 0 && getEmptySlotsByType(newSlot.vehicleType).length === 0">
        No available slots for {{ newSlot.vehicleType }}
      </p>
    </div>

    <!-- Floor Layout -->
    <h2>Slot Layout</h2>
    <div class="floors-layout">
      <div class="floor-column" *ngFor="let fl of floors">
        <h3>{{ fl.label }}</h3>
        <div class="slot-matrix">
          <!-- Bikes (A..D) -->
          <ng-container *ngIf="fl.type=='bike'">
            <div *ngFor="let r of rows" class="slot-row">
              <div *ngFor="let c of cols" class="slot-box"
                   [ngClass]="getSlotClass(r+c, fl.type)"
                   (click)="selectSlotFromMatrix(r+c, fl.type)">
                {{ r + c }}
              </div>
            </div>
          </ng-container>

          <!-- Cars (E..H) -->
          <ng-container *ngIf="fl.type=='car'">
            <div *ngFor="let r of rows" class="slot-row">
              <div *ngFor="let c of cols" class="slot-box"
                   [ngClass]="getSlotClass(toChar(r,4)+c, fl.type)"
                   (click)="selectSlotFromMatrix(toChar(r,4)+c, fl.type)">
                {{ toChar(r,4) + c }}
              </div>
            </div>
          </ng-container>

          <!-- Trucks (L..O) -->
          <ng-container *ngIf="fl.type=='truck'">
            <div *ngFor="let r of rows" class="slot-row">
              <div *ngFor="let c of cols" class="slot-box"
                   [ngClass]="getSlotClass(toChar(r,10)+c, fl.type)"
                   (click)="selectSlotFromMatrix(toChar(r,10)+c, fl.type)">
                {{ toChar(r,10) + c }}
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>

    <!-- Enhanced Add Modal -->
    <div class="modal" *ngIf="showAddModal" (click)="closeAddModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Add Slot</h2>
          <button class="close-btn" (click)="closeAddModal()">&times;</button>
        </div>



        <div class="form-group">
          <label for="vehicleType">Vehicle Type</label>
          <select
            id="vehicleType"
            [(ngModel)]="newSlot.vehicleType"
            (change)="onVehicleTypeChange()"
            class="form-control">
            <option value="">Select Vehicle Type</option>
            <option value="bike">Bike</option>
            <option value="car">Car</option>
            <option value="truck">Truck</option>
          </select>
        </div>

        <!-- Available Slots Preview -->
        <div class="available-slots-section" *ngIf="newSlot.vehicleType">
          <label class="section-label">Available Slots for {{ newSlot.vehicleType | titlecase }}:</label>
          <div class="slots-preview">
            <div
              *ngFor="let slot of getAvailableSlotsByType(newSlot.vehicleType)"
              class="preview-slot available"
              (click)="selectSlotForBooking(slot)">
              {{ convertForDisplay(slot) }}
            </div>
            <div
              *ngFor="let emptySlot of getEmptySlotsByType(newSlot.vehicleType)"
              class="preview-slot empty"
              (click)="selectEmptySlot(emptySlot)">
              {{ emptySlot }}
            </div>
          </div>
          <p class="slots-info" *ngIf="getAvailableSlotsByType(newSlot.vehicleType).length === 0 && getEmptySlotsByType(newSlot.vehicleType).length === 0">
            No available slots for {{ newSlot.vehicleType }}
          </p>
        </div>

        <div class="form-group" *ngIf="selectedSlotForBooking">
          <label>Selected Slot: <span class="selected-slot-display">{{ selectedSlotForBooking }}</span></label>
        </div>

        <div class="form-group">
          <label for="hourlyRate">Hourly Rate</label>
          <input
            id="hourlyRate"
            type="number"
            [(ngModel)]="newSlot.hourlyRate"
            min="1"
            class="form-control">
        </div>

        <div class="modal-actions">
          <button class="btn-secondary" (click)="closeAddModal()">Cancel</button>
          <button class="btn-primary" (click)="addSlot()" [disabled]="!isFormValid()">Add Slot</button>
        </div>
      </div>
    </div>

    <!-- Slots Table -->

  </div>
</div>
